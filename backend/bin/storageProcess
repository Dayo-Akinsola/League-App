#!/app/.heroku/node/bin/node
// const { createClient } = require('redis');
const Queue = require('bull');
const Storage = require('../storage/storage.js');
const storeData = require('../storage/storeData');

const REDIS_URL = process.env.REDISTOGO_URL || 'redis://127.0.0.1:6379';
const connectToRedisServer = async () => {
  let redis;
  if (process.env.REDISTOGO_URL) {
    const rtg = new URL(process.env.REDISTOGO_URL);
    redis = require('redis').createClient(rtg.port, rtg.hostname);
    redis.auth(rtg.auth.split(":")[1]);
  }

  else {
    redis = require('redis').createClient();
  }

  
  redis.on('error', (err) => console.log('Redis Client Error', err));

  await redis.connect();
}

const processStorage = async () => {
  await connectToRedisServer();

  const storageQueue = new Queue('storage', REDIS_URL);

  storageQueue.process(async (job, done) => {
    // await storeData(newStorage);
    console.log('fish');
    done();
  });

  const newStorage = Storage();

  storageQueue.add({});
}

processStorage();






