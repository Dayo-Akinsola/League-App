#!/app/.heroku/node/bin/node
const { createClient } = require('redis');
const Queue = require('bull');
const Storage = require('../storage/storage.js');
const storeData = require('../storage/storeData');

const REDIS_URL = process.env.REDIS_TLS_URL || 'redis://127.0.0.1:6379';

const connectToRedisServer = async () => {
  let client;
  if (process.env.REDIS_TLS_URL) {
    client = createClient(REDIS_URL, {
      tls: {
        rejectUnauthorized: false,
      }
    });
  } else {
    client = createClient();
  }
  
  client.on('error', (err) => console.log('Redis Client Error', err));

  await client.connect();
}

const processStorage = async () => {
  await connectToRedisServer();

  const storageQueue = new Queue('storage', REDIS_URL);

  storageQueue.process(async (job, done) => {
    // await storeData(newStorage);
    console.log('fish');
    done();
  });

  const newStorage = Storage();

  storageQueue.add({});
}

processStorage();






